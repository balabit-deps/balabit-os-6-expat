commit a5f2d0406056d384cdd4b9955384703137a4d19a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 20 20:26:27 2016 +0100

    Extract method gather_time_entropy

diff --git a/lib/xmlparse.c b/lib/xmlparse.c
index 41299da..998def3 100644
--- a/lib/xmlparse.c
+++ b/lib/xmlparse.c
@@ -693,7 +693,7 @@ static const XML_Char implicitContext[] = {
 };
 
 static unsigned long
-generate_hash_secret_salt(void)
+gather_time_entropy(void)
 {
   struct timeval tv;
   int gettimeofday_res;
@@ -701,10 +701,16 @@ generate_hash_secret_salt(void)
   gettimeofday_res = gettimeofday(&tv, NULL);
   assert (gettimeofday_res == 0);
 
-  /* Microseconds time is <20 bits entropy
-   * Process ID is 0 bits entropy if attacker has local access
+  /* Microseconds time is <20 bits entropy */
+  return tv.tv_usec;
+}
+
+static unsigned long
+generate_hash_secret_salt(void)
+{
+  /* Process ID is 0 bits entropy if attacker has local access
    * Factor is 2^61-1 (Mersenne prime M61) */
-  return (tv.tv_usec ^ getpid()) * 2305843009213693951;
+  return (gather_time_entropy() ^ getpid()) * 2305843009213693951;
 }
 
 static XML_Bool  /* only valid for root parser */
